
import test from 'ava';
import * as rp from 'request-promise-native'
import { api } from './helpers'
const request = require('supertest');

test('/api/main', async t => {
  t.plan(2);

  const res = await request(api())
    .get('/api')

  t.is(res.status, 200);
  t.deepEqual(res.body, {
    "routes": [
      "/api/affiliations",
      "/api/competitors",
      "/api/competitions",
      "/api/levels",
      "/api/styles",
      "/api/events",
      "/api/rounds",
      "/api/partnerships",
      "/api/organizations",
      "/api/payment_records",
      "/api/callbacks",
      "/api/admins",
      "/api/officials",
      "api/querytest"
    ]
  });
});


test('api/competitions', async t => {
    t.plan(2);
    const res = await request(api())
    .get('/api/competitions')

    t.is(res.status,200);
    t.deepEqual(res.body, 
    [{"id":1,"name":"Cornell DanceSport Classic","leadidstartnum":1,"locationname":"Ithaca, New York","earlyprice":"10.00","regularprice":"20.00","lateprice":"30.00","startdate":"2017-05-09T04:00:00.000Z","enddate":"2017-05-10T04:00:00.000Z","regstartdate":"2017-05-05T04:00:00.000Z","earlyregdeadline":"2017-05-07T04:00:00.000Z","regularregdeadline":"2017-05-08T04:00:00.000Z","lateregdeadline":"2017-05-09T04:00:00.000Z","compadmin":"admin@email.edu","currentroundid":1,"description":"description"},{"id":2,"name":"test_competition","leadidstartnum":null,"locationname":"cornell_university","earlyprice":null,"regularprice":null,"lateprice":null,"startdate":null,"enddate":null,"regstartdate":null,"earlyregdeadline":null,"regularregdeadline":null,"lateregdeadline":null,"compadmin":null,"currentroundid":null,"description":null}])
});


test('api/affiliations', async t => {
    t.plan(2);
    const res = await request(api())
    .get('/api/affiliations')

    t.is(res.status,200);
    t.deepEqual(res.body, 
    [{"id":1,"name":"Cornell Dance Team"},{"id":2,"name":"Harvard Dance Team"},{"id":3,"name":"MIT Dance Team"},{"id":4,"name":"Princeton Dance Team"}]
)});

test('api/competitors', async t => {
    t.plan(2);
    const res = await request(api())
    .get('/api/competitors')

    t.is(res.status,200);
    t.deepEqual(res.body, 
    [{"id":1,"firstname":"Luke","lastname":"Skywalker","email":"luke@skywalker.com","mailingaddress":"Tatooine","affiliationid":1,"hasregistered":true},{"id":2,"firstname":"Leia","lastname":"Organa","email":"leia@organa.com","mailingaddress":"Alderaan","affiliationid":1,"hasregistered":true},{"id":3,"firstname":"Rey","lastname":"who knows","email":"rey@rey.com","mailingaddress":"Jakku","affiliationid":1,"hasregistered":false},{"id":4,"firstname":"fname4","lastname":"lname4","email":"email4@email.com","mailingaddress":"mailingaddress4","affiliationid":2,"hasregistered":false},{"id":5,"firstname":"fname5","lastname":"lname5","email":"email5@email.com","mailingaddress":"mailingaddress5","affiliationid":2,"hasregistered":false},{"id":6,"firstname":"fname6","lastname":"lname7","email":"email6@email.com","mailingaddress":"mailingaddress6","affiliationid":3,"hasregistered":false},{"id":7,"firstname":"fname7","lastname":"lname7","email":"email7@email.com","mailingaddress":"mailingaddress7","affiliationid":4,"hasregistered":false},{"id":8,"firstname":"fname8","lastname":"lname8","email":"email8@email.com","mailingaddress":"mailingaddress8","affiliationid":4,"hasregistered":false},{"id":9,"firstname":"fname9","lastname":"lname9","email":"email9@email.com","mailingaddress":"mailingaddress9","affiliationid":4,"hasregistered":false},{"id":10,"firstname":"fname10","lastname":"lname10","email":"email10@email.com","mailingaddress":"mailingaddress10","affiliationid":4,"hasregistered":false},{"id":11,"firstname":"fname11","lastname":"lname11","email":"email11@email.com","mailingaddress":"mailingaddress11","affiliationid":4,"hasregistered":false},{"id":12,"firstname":"fname12","lastname":"lname12","email":"email12@email.com","mailingaddress":"mailingaddress12","affiliationid":4,"hasregistered":false},{"id":13,"firstname":"fname13","lastname":"lname13","email":"email13@email.com","mailingaddress":"mailingaddress13","affiliationid":4,"hasregistered":false},{"id":14,"firstname":"fname14","lastname":"lname14","email":"email14@email.com","mailingaddress":"mailingaddress14","affiliationid":4,"hasregistered":false},{"id":15,"firstname":"fname15","lastname":"lname15","email":"email15@email.com","mailingaddress":"mailingaddress15","affiliationid":4,"hasregistered":false},{"id":16,"firstname":"fname16","lastname":"lname16","email":"email16@email.com","mailingaddress":"mailingaddress16","affiliationid":4,"hasregistered":false},{"id":17,"firstname":"fname17","lastname":"lname17","email":"email17@email.com","mailingaddress":"mailingaddress17","affiliationid":4,"hasregistered":false},{"id":18,"firstname":"fname18","lastname":"lname18","email":"email18@email.com","mailingaddress":"mailingaddress18","affiliationid":4,"hasregistered":false},{"id":19,"firstname":"fname19","lastname":"lname19","email":"email19@email.com","mailingaddress":"mailingaddress19","affiliationid":4,"hasregistered":false},{"id":20,"firstname":"fname20","lastname":"lname20","email":"email20@email.com","mailingaddress":"mailingaddress20","affiliationid":4,"hasregistered":false},{"id":21,"firstname":"fname21","lastname":"lname21","email":"email21@email.com","mailingaddress":"mailingaddress21","affiliationid":4,"hasregistered":false},{"id":22,"firstname":"fname22","lastname":"lname22","email":"email22@email.com","mailingaddress":"mailingaddress22","affiliationid":4,"hasregistered":false},{"id":23,"firstname":"fname23","lastname":"lname23","email":"email23@email.com","mailingaddress":"mailingaddress23","affiliationid":4,"hasregistered":false},{"id":24,"firstname":"fname24","lastname":"lname24","email":"email24@email.com","mailingaddress":"mailingaddress24","affiliationid":4,"hasregistered":false},{"id":25,"firstname":"fname25","lastname":"lname25","email":"email25@email.com","mailingaddress":"mailingaddress25","affiliationid":4,"hasregistered":false},{"id":26,"firstname":"fname26","lastname":"lname26","email":"email26@email.com","mailingaddress":"mailingaddress26","affiliationid":4,"hasregistered":false},{"id":27,"firstname":"fname27","lastname":"lname27","email":"email27@email.com","mailingaddress":"mailingaddress27","affiliationid":4,"hasregistered":false},{"id":28,"firstname":"fname28","lastname":"lname28","email":"email28@email.com","mailingaddress":"mailingaddress28","affiliationid":4,"hasregistered":false},{"id":29,"firstname":"fname29","lastname":"lname29","email":"email29@email.com","mailingaddress":"mailingaddress29","affiliationid":4,"hasregistered":false},{"id":30,"firstname":"fname30","lastname":"lname30","email":"email30@email.com","mailingaddress":"mailingaddress30","affiliationid":4,"hasregistered":false},{"id":31,"firstname":"fname31","lastname":"lname31","email":"email31@email.com","mailingaddress":"mailingaddress31","affiliationid":4,"hasregistered":false},{"id":32,"firstname":"fname32","lastname":"lname32","email":"email32@email.com","mailingaddress":"mailingaddress32","affiliationid":4,"hasregistered":false},{"id":33,"firstname":"fname33","lastname":"lname33","email":"email33@email.com","mailingaddress":"mailingaddress33","affiliationid":4,"hasregistered":false},{"id":34,"firstname":"fname34","lastname":"lname34","email":"email34@email.com","mailingaddress":"mailingaddress34","affiliationid":4,"hasregistered":false},{"id":35,"firstname":"fname35","lastname":"lname35","email":"email35@email.com","mailingaddress":"mailingaddress35","affiliationid":4,"hasregistered":false},{"id":36,"firstname":"fname36","lastname":"lname36","email":"email36@email.com","mailingaddress":"mailingaddress36","affiliationid":4,"hasregistered":false},{"id":37,"firstname":"fname37","lastname":"lname37","email":"email37@email.com","mailingaddress":"mailingaddress37","affiliationid":4,"hasregistered":false},{"id":38,"firstname":"fname38","lastname":"lname38","email":"email38@email.com","mailingaddress":"mailingaddress38","affiliationid":4,"hasregistered":false},{"id":39,"firstname":"fname39","lastname":"lname39","email":"email39@email.com","mailingaddress":"mailingaddress39","affiliationid":4,"hasregistered":false},{"id":40,"firstname":"fname40","lastname":"lname40","email":"email40@email.com","mailingaddress":"mailingaddress40","affiliationid":4,"hasregistered":false},{"id":41,"firstname":"fname41","lastname":"lname41","email":"email41@email.com","mailingaddress":"mailingaddress41","affiliationid":4,"hasregistered":false},{"id":42,"firstname":"fname42","lastname":"lname42","email":"email42@email.com","mailingaddress":"mailingaddress42","affiliationid":4,"hasregistered":false},{"id":43,"firstname":"fname43","lastname":"lname43","email":"email43@email.com","mailingaddress":"mailingaddress43","affiliationid":4,"hasregistered":false},{"id":44,"firstname":"fname44","lastname":"lname44","email":"email44@email.com","mailingaddress":"mailingaddress44","affiliationid":4,"hasregistered":false},{"id":45,"firstname":"fname45","lastname":"lname45","email":"email45@email.com","mailingaddress":"mailingaddress45","affiliationid":4,"hasregistered":false},{"id":46,"firstname":"fname46","lastname":"lname46","email":"email46@email.com","mailingaddress":"mailingaddress46","affiliationid":4,"hasregistered":false},{"id":47,"firstname":"fname47","lastname":"lname47","email":"email47@email.com","mailingaddress":"mailingaddress47","affiliationid":4,"hasregistered":false},{"id":48,"firstname":"fname48","lastname":"lname48","email":"email48@email.com","mailingaddress":"mailingaddress48","affiliationid":4,"hasregistered":false},{"id":49,"firstname":"fname49","lastname":"lname49","email":"email49@email.com","mailingaddress":"mailingaddress49","affiliationid":4,"hasregistered":false},{"id":50,"firstname":"fname50","lastname":"lname50","email":"email50@email.com","mailingaddress":"mailingaddress50","affiliationid":4,"hasregistered":false},{"id":51,"firstname":null,"lastname":null,"email":"admin@admin.com","mailingaddress":null,"affiliationid":4,"hasregistered":true}]
    )});


test('api/payment_records', async t => {
    t.plan(2);
    const res = await request(api())
    .get('/api/payment_records')

    t.is(res.status,200);
    t.deepEqual(res.body, 
    [{"id":2,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":1,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":3,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":2,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":4,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":3,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":5,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":4,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":6,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":5,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":7,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":6,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":8,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":7,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":9,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":8,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":10,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":9,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":11,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":10,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":12,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":11,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":13,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":12,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":14,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":13,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":15,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":14,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":16,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":15,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":17,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":16,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":18,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":17,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":19,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":18,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":20,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":19,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":21,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":20,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":22,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":21,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":23,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":22,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":24,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":23,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":25,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":24,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":26,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":25,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":27,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":26,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":28,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":27,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":29,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":28,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":30,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":29,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":31,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":30,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":32,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":31,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":33,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":32,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":34,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":33,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":35,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":34,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":36,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":35,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":37,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":36,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":38,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":37,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":39,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":38,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":40,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":39,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":41,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":40,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":42,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":41,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":43,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":42,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":44,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":43,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":45,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":44,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":46,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":45,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":47,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":46,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":48,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":47,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":49,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":48,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":50,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":49,"amount":"21.87","online":true,"paidwithaffiliation":true},{"id":51,"competitionid":1,"timestamp":"2017-05-10T04:00:00.000Z","competitorid":50,"amount":"21.87","online":true,"paidwithaffiliation":true}]
    )});

test('api/admins', async t => {
    t.plan(2);
    const res = await request(api())
    .get('/api/admins')

    t.is(res.status,200);
    t.deepEqual(res.body, 
    [{"email":"admin@email.edu"}]
   )});